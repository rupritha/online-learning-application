{"version":3,"names":["clearCheckout","clearSavedCheckout","state","formId","mode","_a","checkout","id","lockCheckout","lockName","locks","unLockCheckout","filter","name","updateCheckoutLineItem","async","data","updateFormState","updateLineItem","e","console","error","createErrorNotice","removeCheckoutLineItem","removeLineItem","checkoutId","itemId","addCheckoutLineItem","addLineItem","live_mode","trackOrderBump","bumpId","apiFetch","path","addQueryArgs","t","Date","now","_c","_b","invoice","type","method","keepalive","window","sc"],"sources":["src/store/checkout/mutations.ts"],"sourcesContent":["import state from './store';\nimport { clearCheckout as clearSavedCheckout } from '../checkouts/mutations';\nimport { updateFormState } from '@store/form/mutations';\nimport { createErrorNotice } from '@store/notices/mutations';\nimport { addLineItem, removeLineItem, updateLineItem } from '../../services/session';\nimport apiFetch from '../../functions/fetch';\nimport { Invoice } from '../../types';\nimport { addQueryArgs } from '@wordpress/url';\n\n/**\n * Clear the current checkout.\n */\nexport const clearCheckout = () => {\n  clearSavedCheckout(state.formId, state.mode, state.checkout?.id);\n};\n\n/**\n * Lock the checkout (disables input and submission)\n * Pass a lock name to prevent conflicts and allow multiple locks.\n */\nexport const lockCheckout = lockName => (state.locks = [...state.locks, lockName]);\n\n/**\n * Unlock the checkout.\n * Pass an optional lock name to only unlock a specific lock\n */\nexport const unLockCheckout = (lockName = '') => (state.locks = !!lockName ? state.locks.filter(name => name !== lockName) : []);\n\n/**\n * Update the checkout line item\n */\nexport const updateCheckoutLineItem = async ({ id, data }) => {\n  try {\n    updateFormState('FETCH');\n    state.checkout = await updateLineItem({\n      id: id,\n      data,\n    });\n    updateFormState('RESOLVE');\n  } catch (e) {\n    console.error(e);\n    createErrorNotice(e);\n    updateFormState('REJECT');\n  }\n};\n\n/**\n * Remove the checkout line item.\n */\nexport const removeCheckoutLineItem = async id => {\n  try {\n    updateFormState('FETCH');\n    state.checkout = await removeLineItem({\n      checkoutId: state.checkout.id,\n      itemId: id,\n    });\n    updateFormState('RESOLVE');\n  } catch (e) {\n    console.error(e);\n    createErrorNotice(e);\n    updateFormState('REJECT');\n  }\n};\n\n/**\n * Add the checkout line item.\n */\nexport const addCheckoutLineItem = async data => {\n  try {\n    updateFormState('FETCH');\n    state.checkout = await addLineItem({\n      checkout: state.checkout,\n      data,\n      live_mode: state?.mode === 'live',\n    });\n    updateFormState('RESOLVE');\n  } catch (e) {\n    console.error(e);\n    createErrorNotice(e);\n    updateFormState('REJECT');\n  }\n};\n\n/**\n * Track order bump offers.\n */\nexport const trackOrderBump = (bumpId: string) => {\n  if (!state.checkout?.id) {\n    return;\n  }\n\n  apiFetch({\n    path: addQueryArgs(`surecart/v1/checkouts/${state.checkout.id}/offer_bump/${bumpId}`, {\n      t: Date.now(),\n      ...(!!(state?.checkout?.invoice as Invoice)?.id && { type: 'open_invoice' }),\n    }),\n    method: 'POST',\n    keepalive: true, // Important: allow the request to outlive the page.\n  });\n};\n\nwindow.sc = {\n  ...(window?.sc || {}),\n  checkout: {\n    ...(window?.sc?.checkout || {}),\n    addLineItem: addCheckoutLineItem,\n  },\n};\n"],"mappings":"4NAYaA,EAAgB,K,MAC3BC,EAAmBC,EAAMC,OAAQD,EAAME,MAAMC,EAAAH,EAAMI,YAAQ,MAAAD,SAAA,SAAAA,EAAEE,GAAG,E,MAOrDC,EAAeC,GAAaP,EAAMQ,MAAQ,IAAIR,EAAMQ,MAAOD,G,MAM3DE,EAAiB,CAACF,EAAW,KAAQP,EAAMQ,QAAUD,EAAWP,EAAMQ,MAAME,QAAOC,GAAQA,IAASJ,IAAY,G,MAKhHK,EAAyBC,OAASR,KAAIS,WACjD,IACEC,EAAgB,SAChBf,EAAMI,eAAiBY,EAAe,CACpCX,GAAIA,EACJS,SAEFC,EAAgB,U,CAChB,MAAOE,GACPC,QAAQC,MAAMF,GACdG,EAAkBH,GAClBF,EAAgB,S,SAOPM,EAAyBR,MAAMR,IAC1C,IACEU,EAAgB,SAChBf,EAAMI,eAAiBkB,EAAe,CACpCC,WAAYvB,EAAMI,SAASC,GAC3BmB,OAAQnB,IAEVU,EAAgB,U,CAChB,MAAOE,GACPC,QAAQC,MAAMF,GACdG,EAAkBH,GAClBF,EAAgB,S,SAOPU,EAAsBZ,MAAMC,IACvC,IACEC,EAAgB,SAChBf,EAAMI,eAAiBsB,EAAY,CACjCtB,SAAUJ,EAAMI,SAChBU,OACAa,WAAW3B,IAAK,MAALA,SAAK,SAALA,EAAOE,QAAS,SAE7Ba,EAAgB,U,CAChB,MAAOE,GACPC,QAAQC,MAAMF,GACdG,EAAkBH,GAClBF,EAAgB,S,SAOPa,EAAkBC,I,UAC7B,MAAK1B,EAAAH,EAAMI,YAAQ,MAAAD,SAAA,SAAAA,EAAEE,IAAI,CACvB,M,CAGFyB,EAAS,CACPC,KAAMC,EAAa,yBAAyBhC,EAAMI,SAASC,iBAAiBwB,IAAU,CACpFI,EAAGC,KAAKC,aACFC,GAACC,EAAArC,IAAK,MAALA,SAAK,SAALA,EAAOI,YAAQ,MAAAiC,SAAA,SAAAA,EAAEC,WAAmB,MAAAF,SAAA,SAAAA,EAAE/B,KAAM,CAAEkC,KAAM,kBAE7DC,OAAQ,OACRC,UAAW,MACX,EAGJC,OAAOC,GAAK,KACND,SAAM,MAANA,cAAM,SAANA,OAAQC,KAAM,GAClBvC,SAAU,MACJD,EAAAuC,SAAM,MAANA,cAAM,SAANA,OAAQC,MAAE,MAAAxC,SAAA,SAAAA,EAAEC,WAAY,GAC5BsB,YAAaD,W","ignoreList":[]}