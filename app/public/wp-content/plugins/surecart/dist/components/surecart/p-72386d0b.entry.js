import{r as t,h as s,a as e}from"./p-e97fde0a.js";import{a}from"./p-d9fa04f9.js";import{o as i}from"./p-b719a497.js";import{a as o}from"./p-401e165e.js";import"./p-d3366af3.js";const h=":host{display:block}.download__details{opacity:0.75}";const n=h;const d=class{constructor(s){t(this,s);this.query={page:1,per_page:10};this.allLink=undefined;this.heading=undefined;this.isCustomer=undefined;this.requestNonce=undefined;this.purchases=[];this.loading=undefined;this.busy=undefined;this.error=undefined;this.pagination={total:0,total_pages:0}}componentWillLoad(){i(this.el,(()=>{this.initialFetch()}))}async initialFetch(){if(!this.isCustomer){return}try{this.loading=true;await this.getItems()}catch(t){console.error(this.error);this.error=(t===null||t===void 0?void 0:t.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.loading=false}}async fetchItems(){if(!this.isCustomer){return}try{this.busy=true;await this.getItems()}catch(t){console.error(this.error);this.error=(t===null||t===void 0?void 0:t.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.busy=false}}async getItems(){const t=await await a({path:o(`surecart/v1/purchases/`,{expand:["product","product.downloads","download.media"],downloadable:true,revoked:false,...this.query}),parse:false});this.pagination={total:parseInt(t.headers.get("X-WP-Total")),total_pages:parseInt(t.headers.get("X-WP-TotalPages"))};this.purchases=await t.json();return this.purchases}nextPage(){this.query.page=this.query.page+1;this.fetchItems()}prevPage(){this.query.page=this.query.page-1;this.fetchItems()}render(){var t;return s("sc-purchase-downloads-list",{key:"8a407e34ef1f0391cd10eaa26fe39f9b514df13d",heading:this.heading,allLink:this.allLink&&this.pagination.total_pages>1?this.allLink:"",loading:this.loading,busy:this.busy,requestNonce:this.requestNonce,error:this.error,purchases:this.purchases},s("span",{key:"96f5cfb120ced4bb1df6c7fe91ceac0d8404211e",slot:"heading"},s("slot",{key:"350f2eeeef60a8e1e02e45b254bbf7e1445c3c9a",name:"heading"},this.heading||wp.i18n.__("Downloads","surecart"))),s("sc-pagination",{key:"dcf0d6d0c55b026de43a23cabb495aac69702686",slot:"after",page:this.query.page,perPage:this.query.per_page,total:this.pagination.total,totalPages:this.pagination.total_pages,totalShowing:(t=this===null||this===void 0?void 0:this.purchases)===null||t===void 0?void 0:t.length,onScNextPage:()=>this.nextPage(),onScPrevPage:()=>this.prevPage()}))}get el(){return e(this)}};d.style=n;export{d as sc_dashboard_downloads_list};
//# sourceMappingURL=p-72386d0b.entry.js.map